This README file contains information on the contents of the
qr-linux layer.

Please see the corresponding sections below for details.


Dependencies
============

This layer depends on:

  URI: git://git.openembedded.org/bitbake
  branch: master
  revision: 1484905373ad717cedcaef37a0addde034ebdc60

  URI: git://git.openembedded.org/openembedded-core
  layers: meta
  branch: master
  revision: 7e2dbda690b480ab05d14353cb038749ce23d58c

  URI: git://git.linaro.org/openembedded/meta-linaro
  layers: meta-linaro
  branch: master
  revision: 179a002f019dfbbe1e0851f768bbd9620242b7f0

Patches
=======

Please submit any patches against the qr-linux layer to the
QR Linux forum (https://www.codeaurora.org/forums/qr-linux) and cc: the maintainer:

Maintainer: Rahul Anand <ranand@codeaurora.org>


Table of Contents
=================

  I. Building QR Linux
 II. For More Information


I. Building QR Linux
=================================================

The following instructions assume that you are working from an Ubuntu
12.04 (or later) system. The steps for other systmes will be similar,
and should be easily discerned from what follows.

A. Install Required Packages

Yocto requires access to the programs diffstat, texinfo, gawk,
and chrpath. We also need multistrap for building the user
space. You can get them by using apt-get. Be sure to log in as
root, or use sudo.

    apt-get install diffstat texinfo gawk chrpath multistrap


B. Fetch Build system

To build the system, you must first use repo to set up the system
build tree. To do this, enter the following:

    mkdir oe-core
    cd oe-core 
    repo init -u git://codeaurorua.org/qr-lnux/manifest  -b 14_master
    repo sync

This fetches the core pieces of the open embedded system, including
bitbake, sets up the build directory, and downloads the layers
necessary for building QR Linux.

C. Perform Your First Build

Begin by initializing the build environment from oe-core:
  
    source oe-init-build-env build

QR Linux uses a pre-compiled, external toolchain from Linaro. This
matches the compiler that comes standard with Ubuntu, and will allow
us to make compatible builds. Included is a script that downloads the
appropriate binary, and unpacks it into the appropriate space in the
build tree. This needs to be run only once, when you are first setting
everything else. 

    meta-qr-linux/scripts/linaro-fetch.sh

At this point, you are ready to construct the system. We build
everything using the core-image-qrl recipe. Before you begin, you need
to decide which platform you are building for, and prepare to specify
that machine on the command line. The current release supports the
Inforce IFC6410 (MACHINE="ifc6410") or the QR Linux System On Module
(SOM) (MACHINE="som8064"). To execute the build, type:

    MACHINE="ifc6410" bitbake core-image-qrl
or
    MACHINE="som8064" bitbake core-image-qrl

D. Download the Images

If all has gone well, there should now be a directory under your build
called tmp-eglibc/deploy/images/<machine name>. In there, you will
find a file called boot.img. This is the kernel image. You will also
find a file called userdata.img. This is the userspace you have
built. Installation of these files depends on the machine that is the
installation target.

i. SOM8064
 
To install your images on the SOM8064, you use fastboot, which was
conveniently produced for you during the build process. Begin by
rebooting your system into fastboot mode. Then execute the following
commands from the build directory:

    tmp-eglibc/sysroots/x86_64-linux/usr/bin/fastboot erase boot 
    tmp-eglibc/sysroots/x86_64-linux/usr/bin/fastboot flash boot tmp-eglibc/deploy/images/som8064/boot.img
    tmp-eglibc/sysroots/x86_64-linux/usr/bin/fastboot erase userdata
    tmp-eglibc/sysroots/x86_64-linux/usr/bin/fastboot flash userdata tmp-eglibc/deploy/images/som8064/userdata.img
    tmp-eglibc/sysroots/x86_64-linux/usr/bin/fastboot reboot

At this point, the system will boot, initialize, and reboot. You
should end up with a login prompt. Enter:

login: root
Password: clarence

Congratulations! You have now built and installed QR Linux.

ii. IFC6410

To install your images on the IFC6410, you use adb and fastboot, which
were conveniently produced for you during the build process. To use
them, you will have to add the systroot in your build directory into
your path.

    export PATH=`pwd`/tmp-eglibc/sysroots/x86_64-linux/usr/bin/:$PATH
    
You will also need a USB drive with a capacity of at least 8GB. The
first time you use this drive, you need to format it with a GPT
partition. Once you have done this, you can copy the your userspace to
the drive.

Attach the USB drive to you build machine. In a terminal window, type:

dmesg | grep Attached | tail -1

You should see a device reference, e.g. /dev/sdb. That is your flash
drive. For the rest of this document, we will assume that the device
is /dev/sdb. Now copy the userdata.img.

    sudo dd if=userdata.img of=/dev/sdb1

When the command finishes, unplug the USB drive.

NOTE: Once the drive is properly formatted, plugging it into the
machine may cause the disk to become mounted. If this happens, eject
the disk, and then execute the last command to put the userdata.img
onto the drive.

To bring your system up, plug the USB drive into your system, and 
reboot your system into fastboot mode. Then execute the following
commands from the build directory:

    fastboot flash boot tmp-eglibc/deploy/images/ifc6410/boot.img
    fastboot reboot

WARNING: The above command will replace the Android boot image
with a Linux boot image. To run Android, you will have to reflash your
original Android boot image. If you wish to maintain your Android boot
image, you can do the following:

    fastboot boot tmp-eglibc/deploy/images/ifc6410/boot.img

At this point, the system will boot, initialize, and reboot into
Android. You now have to do a final boot using fastboot.

    adb reboot-bootloader
    fastboot boot tmp-eglibc/deploy/images/ifc6410/boot.img

Either way, you should end up with a login prompt.  Enter:

login: root
Password: clarence

Congratulations!  You have now built and installed QR Linux.


II. For More Information
========

Now that you have a booting system, you are going to want to modify
it, adding new packages, and building your own
applications. Information for doing this can be found on the wiki at
https://www.codeaurora.org/xwiki/bin/QR+Linux/WebHome, and on the
support forum at https://www.codeaurora.org/forums/qr-linux. 

