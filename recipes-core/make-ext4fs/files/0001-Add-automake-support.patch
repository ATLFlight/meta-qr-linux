From 144b76040e8e79b4689a798ed2eea080b529a274 Mon Sep 17 00:00:00 2001
From: Gustavo Solaira <gustavos@codeaurora.org>
Date: Thu, 13 Aug 2015 17:20:17 -0700
Subject: [PATCH] Add automake support

---
 Makefile.am  | 37 +++++++++++++++++++++++++++++++++++++
 configure.ac | 28 ++++++++++++++++++++++++++++
 2 files changed, 65 insertions(+)
 create mode 100644 Makefile.am
 create mode 100644 configure.ac

diff --git a/Makefile.am b/Makefile.am
new file mode 100644
index 0000000..a19f17d
--- /dev/null
+++ b/Makefile.am
@@ -0,0 +1,37 @@
+AM_CFLAGS = -Wundef \
+        -Wstrict-prototypes \
+        -Wno-trigraphs \
+        -g -O0 \
+        -fno-inline \
+        -fno-short-enums \
+        -fpic \
+        -DANDROID \
+        -DHAVE_ANDROID_OS \
+        -DHOST \
+        $(LIBSELINUX_CFLAGS)
+
+AM_CPPFLAGS = $(AM_CFLAGS)
+
+ACLOCAL_AMFLAGS = -I m4
+
+### Build libsext4_utils library
+
+libext4utilsincludedir = $(includedir)
+libext4utilsinclude_HEADERS = ext4_utils/make_ext4fs.h ext4_utils/ext4_utils.h ext4_utils/ext4.h
+
+libext4_utils_c_sources :=  ext4_utils/make_ext4fs.c \
+    ext4_utils/ext4fixup.c \
+    ext4_utils/ext4_utils.c \
+    ext4_utils/allocate.c \
+    ext4_utils/contents.c \
+    ext4_utils/extent.c \
+    ext4_utils/indirect.c \
+    ext4_utils/uuid.c \
+    ext4_utils/sha1.c \
+    ext4_utils/wipe.c \
+    ext4_utils/crc16.c
+
+libext4_utils_a_SOURCES = $(libext4_utils_c_sources)
+libext4_utils_a_LDFLAGS = -lsparse $(LIBSELINUX_LIBS)
+
+lib_LIBRARIES = libext4_utils.a
diff --git a/configure.ac b/configure.ac
new file mode 100644
index 0000000..320df8b
--- /dev/null
+++ b/configure.ac
@@ -0,0 +1,28 @@
+AC_PREREQ(2.61)
+AC_INIT([make_ext4fs],1.0.0)
+AM_INIT_AUTOMAKE([-Wall gnu foreign])
+AM_MAINTAINER_MODE
+
+AC_CONFIG_HEADER([config.h])
+AC_CONFIG_MACRO_DIR([m4])
+
+# Checks for programs.
+AM_PROG_AS
+AC_PROG_CC
+AM_PROG_CC_C_O
+AC_PROG_AWK
+AC_PROG_CPP
+AC_PROG_CXX
+AC_PROG_LIBTOOL
+AC_PROG_INSTALL
+AC_PROG_LN_S
+AC_PROG_MAKE_SET
+
+AS_CASE([$host],
+        [arm*], [ARM=yes],
+        [ARM=no]
+)
+
+AC_OUTPUT([ \
+        Makefile
+])
-- 
2.4.2

