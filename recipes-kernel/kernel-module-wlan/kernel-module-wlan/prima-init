#!/bin/bash
###############################################################################
## Author: Rahul Anand (ranand@codeaurora.org)
##
## prima-init.sh is auto-generated and is used to bring up the WCN36{6,8}0 chip
## on Linux. It depends on udev to load the required firmware
###############################################################################
if [ "$IFACE" = lo ]; then
    exit 0
fi

QC_FW_TRIGGER_DEVICE=/dev/wcnss_wlan # The device to trigger for fw download

echo 1 > "${QC_FW_TRIGGER_DEVICE}" > /dev/null 2>&1
sleep 1

retVal=0
cfgModule=`grep cfg80211 /proc/modules`
cfgModule=${#cfgModule}
if [ $cfgModule -eq 0 ]
then
   echo "INFO: Loading kernel module: cfg80211 ..."
   modprobe cfg80211 > /dev/null 2>&1
   retVal=$?
fi
if [[ $retVal -ne 0 ]]
then
   echo "ERROR: Loading cfg80211 failed"
   exit $retVal
fi

wlanModule=`grep wlan /proc/modules`
wlanModule=${#wlanModule}
if [ $wlanModule -eq 0 ]
then
   echo "INFO: Loading kernel module: wlan ..."
   modprobe wlan > /dev/null 2>&1
   retVal=$?
fi
exit $retVal

