From d8da8945f5eca84440fbb63d5af32e9678dd0969 Mon Sep 17 00:00:00 2001
From: bharathr <bharathr@codeaurora.org>
Date: Tue, 10 Mar 2015 14:57:23 -0700
Subject: [PATCH] ATL-2435 ATL-2508 Kernel changes to disable GSBI7 SPI

---
 arch/arm/mach-msm/board-8064-gpiomux.c | 2 ++
 arch/arm/mach-msm/board-8064.c         | 3 ++-
 arch/arm/mach-msm/clock-8960.c         | 8 ++++++--
 3 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/arch/arm/mach-msm/board-8064-gpiomux.c b/arch/arm/mach-msm/board-8064-gpiomux.c
index ece510e..55336e3 100644
--- a/arch/arm/mach-msm/board-8064-gpiomux.c
+++ b/arch/arm/mach-msm/board-8064-gpiomux.c
@@ -725,6 +725,7 @@ static struct msm_gpiomux_config apq8064_constitution_gsbi_configs[] __initdata
 			[GPIOMUX_ACTIVE] = &gsbi5_active_cfg,
 		},
 	},
+#if 0 //***	Disable GSBI7 SPI from Krait so aDSP cal use it as UART
 	{
 		.gpio      = APQ8064_SOM_GSBI7_SPI_MOSI,
 		.settings = {
@@ -755,6 +756,7 @@ static struct msm_gpiomux_config apq8064_constitution_gsbi_configs[] __initdata
 			[GPIOMUX_SUSPENDED] = &som_gpio_spi5_config,
 		},
 	},
+#endif //***	
 };
 
 static struct msm_gpiomux_config apq8064_som_gsbi_configs[] __initdata = {
diff --git a/arch/arm/mach-msm/board-8064.c b/arch/arm/mach-msm/board-8064.c
index f5fd3528..59c3976 100644
--- a/arch/arm/mach-msm/board-8064.c
+++ b/arch/arm/mach-msm/board-8064.c
@@ -2417,7 +2417,8 @@ static struct platform_device *early_common_devices[] __initdata = {
 	&apq8064_device_acpuclk,
 	&apq8064_device_dmov,
 #ifdef CONFIG_MACH_APQ8064_SOM
-	&apq8064_device_qup_spi_gsbi7,
+	//*** Disable GSBI7 SPI from Krait so aDSP cal use it as UART​
+	//*** &apq8064_device_qup_spi_gsbi7,
 #else
 	&apq8064_device_qup_spi_gsbi5,
 #endif
diff --git a/arch/arm/mach-msm/clock-8960.c b/arch/arm/mach-msm/clock-8960.c
index 5623c9a..bea1043 100755
--- a/arch/arm/mach-msm/clock-8960.c
+++ b/arch/arm/mach-msm/clock-8960.c
@@ -5314,7 +5314,9 @@ static struct clk_lookup msm_clocks_8064[] = {
 	CLK_LOOKUP("core_clk",		gsbi4_qup_clk.c,	"qup_i2c.4"),
 	CLK_LOOKUP("core_clk",		gsbi5_qup_clk.c,	"qup_i2c.5"),
 	CLK_LOOKUP("core_clk",		gsbi6_qup_clk.c,	""),
-	CLK_LOOKUP("core_clk",		gsbi7_qup_clk.c,	"spi_qsd.0"),
+    //*** Disable GSBI7 SPI from Krait so aDSP cal use it as UART​
+	//*** CLK_LOOKUP("core_clk",		gsbi7_qup_clk.c,	"spi_qsd.0"),
+	CLK_LOOKUP("core_clk",		gsbi7_qup_clk.c,	""),
 
 #else /* else non Constitution */
 
@@ -5407,7 +5409,9 @@ static struct clk_lookup msm_clocks_8064[] = {
 	CLK_LOOKUP("iface_clk",		gsbi5_p_clk.c,	"qup_i2c.5"),
 	CLK_LOOKUP("iface_clk",		gsbi5_p_clk.c,	"msm_serial_hsl.1"),
 	CLK_LOOKUP("iface_clk",		gsbi6_p_clk.c,	""),
-	CLK_LOOKUP("iface_clk",		gsbi7_p_clk.c,	"spi_qsd.0"),
+	//*** Disable GSBI7 SPI from Krait so aDSP cal use it as UART​
+	//*** CLK_LOOKUP("iface_clk",		gsbi7_p_clk.c,	"spi_qsd.0"),
+	CLK_LOOKUP("iface_clk",		gsbi7_p_clk.c,	""),
 
 #else /* else non Constitution */
 #ifdef CONFIG_MACH_LGE
-- 
1.7.11.4

